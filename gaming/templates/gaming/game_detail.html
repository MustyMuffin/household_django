{% extends "household_main/base.html" %}
{% load get_item_filter %}
{% load gaming_extras %}


{% block content %}
<div class="container mt-4">
  <div class="card p-3 shadow rounded-3">
    <div class="d-flex align-items-center">
      {% if game.image_url %}
        <img src="{{ game.image_url }}" alt="{{ game.name }}" style="height: 100px; margin-right: 20px;">
      {% endif %}
      <div>
        <h2>{{ game.name }}</h2>
        {% if game.game_category %}
          <p>üéÆ Category: <strong>{{ game.game_category.name }}</strong></p>
        {% endif %}

        <h5 class="mt-3">üïí Time to Beat Estimates</h5>
      <ul class="list-group mb-3">
        <li class="list-group-item">
          <strong>Main Story:</strong> {{ game.hours_main_story }} hours
        </li>
        <li class="list-group-item">
          <strong>Main + Extra:</strong> {{ game.hours_main_extra }} hours
        </li>
        <li class="list-group-item">
          <strong>Completionist:</strong> {{ game.hours_completionist }} hours
        </li>
      </ul>

      </div>
    </div>

        <a href="{% url 'gaming:log_game_progress' game.id %}" class="btn btn-primary mt-3">
          üéÆ Log Progress
        </a>

        <h4>üß© Collectibles</h4>
        {% if game.collectible_types.all %}
          <ul class="list-group">
            {% for collectible in game.collectible_types.all %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ collectible.name }}
                <span class="badge bg-primary rounded-pill">
                  {{ user_collectibles|dict_get:collectible.id|default:0 }} / {{ collectible.total_available }}
                </span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">No collectibles defined for this game yet.</p>
        {% endif %}

        {% if is_privileged %}
          <h4>Add New Collectible Type</h4>
          <form method="post">
            {% csrf_token %}
            {{ collectible_form.as_p }}
            <button type="submit" name="add_collectible_type" class="btn btn-outline-secondary">
              ‚ûï Add Collectible Type
            </button>
          </form>
        {% endif %}

    {% if description %}
      <hr>
      <p>{{ description }}</p>
    {% endif %}

    {% if achievements %}
      <hr>
      <h5>üèÜ Achievements</h5>
      <ul>
        {% for achievement in achievements %}
          <li>{{ achievement.name }} ‚Äî {{ achievement.description }}</li>
        {% empty %}
          <li>No achievements listed.</li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</div>
{% endblock %}
